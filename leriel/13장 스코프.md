## 📌 13.1 스코프란?

스코프(Scope)는 식별자가 **유효한 범위**를 의미합니다.

```jsx
var x = 'global';

function foo() {
  var x = 'local';
  console.log(x)  // local
}

console.log(x)    // global

```

**스코프의 필요성:**

- 식별자(변수명, 함수명 등) 충돌 방지
- 코드의 가독성과 유지보수성 향상

---

## 📌 13.2 스코프의 종류

### 13.2.1 전역 스코프

**전역 스코프(Global Scope)**: 코드의 가장 바깥 영역, 어디서든 참조 가능

```jsx
// 전역 변수
const global = 'I am global';

function printGlobal() {
  // 전역 변수는 함수 내부에서도 접근 가능
  console.log(global);
}

printGlobal(); // "I am global"
console.log(global); // "I am global"

```

### 전역 스코프 시각화:

```
+------------------------------------------+
|                                          |
|  전역 스코프                                |
|                                          |
|  +----------------------------------+    |
|  |                                  |    |
|  |  함수 스코프                        |    |
|  |                                  |    |
|  |  // 함수 내부에서 전역 변수 접근 가능    |    |
|  |  console.log(global);            |    |
|  |                                  |    |
|  +----------------------------------+    |
|                                          |
|  // 전역 변수                              |
|  const global = 'I am global';           |
|                                          |
+------------------------------------------+

```

### 13.2.2 지역 스코프

**지역 스코프(Local Scope)**: 함수 내부 영역, 해당 함수 내부에서만 참조 가능

```jsx
function outer() {
  // 지역 변수
  const local = 'I am local';
  console.log(local); // "I am local"

  function inner() {
    // 중첩 지역 스코프
    const innerLocal = 'I am inner local';
    console.log(local); // 외부 함수의 지역 변수도 접근 가능
    console.log(innerLocal);
  }

  inner();
  // console.log(innerLocal); // ReferenceError: innerLocal is not defined
}

outer();
// console.log(local); // ReferenceError: local is not defined

```

### 지역 스코프 시각화:

```
+------------------------------------------+
|                                          |
|  전역 스코프                                |
|                                          |
|  +----------------------------------+    |
|  |                                  |    |
|  |  outer 함수 스코프                  |    |
|  |                                  |    |
|  |  const local = 'I am local';     |    |
|  |                                  |    |
|  |  +----------------------------+  |    |
|  |  |                            |  |    |
|  |  |  inner 함수 스코프            |  |    |
|  |  |                            |  |    |
|  |  |  const innerLocal = '...'; |  |    |
|  |  |  // local 변수 접근 가능      |  |    |
|  |  |                            |  |    |
|  |  +----------------------------+  |    |
|  |                                  |    |
|  |  // innerLocal 접근 불가           |    |
|  |                                  |    |
|  +----------------------------------+    |
|                                          |
|  // local 접근 불가                        |
|                                          |
+------------------------------------------+

```

---

## 📌 13.3 스코프 체인

함수가 중첩되어 있을 때 **내부 함수는 외부 함수의 변수에 접근 가능**하지만, **외부 함수는 내부 함수의 변수에 접근할 수 없습니다**.

### 13.3.1 스코프 체인에 의한 변수 검색

**스코프 체인(Scope Chain)**: 스코프가 계층적으로 연결된 것

```jsx
// 전역 스코프
const x = 'global x';
const y = 'global y';

function outer() {
  // outer 함수 스코프
  const x = 'outer x';

  function inner() {
    // inner 함수 스코프
    const x = 'inner x';
    console.log(x); // "inner x" - 가장 가까운 스코프의 변수 참조
    console.log(y); // "global y" - 상위 스코프에서 검색
  }

  inner();
  console.log(x); // "outer x"
}

outer();
console.log(x); // "global x"

```

### 스코프 체인 시각화:

```
+------------------------------------------+
|                                          |
|  전역 스코프                                |
|  const x = 'global x'                    |
|  const y = 'global y'                    |
|                                          |
|  +----------------------------------+    |
|  |                                  |    |
|  |  outer 함수 스코프                  |    |
|  |  const x = 'outer x'             |    |
|  |                                  |    |
|  |  +----------------------------+  |    |
|  |  |                            |  |    |
|  |  |  inner 함수 스코프            |  |    |
|  |  |  const x = 'inner x'       |  |    |
|  |  |                            |  |    |
|  |  |  변수 검색 순서:              |  |    |
|  |  |  1. 현재 스코프에서 x 검색      |  |    |
|  |  |  2. outer 스코프에서 y 검색    |  |    |
|  |  |  3. 전역 스코프에서 y 검색      |  |    |
|  |  |                            |  |    |
|  |  +----------------------------+  |    |
|  |                                  |    |
|  +----------------------------------+    |
|                                          |
+------------------------------------------+

```

### 13.3.2 스코프 체인에 의한 함수 검색

함수도 스코프 체인에 따라 검색됩니다.

```jsx
// 전역 함수
function foo() {
  console.log('global foo');
}

function bar() {
  // 지역 함수(함수 내 함수)
  function foo() {
    console.log('local foo');
  }

  foo(); // "local foo" - 지역 함수 호출
}

bar();
foo(); // "global foo" - 전역 함수 호출

```

---

## 📌 13.4 함수 레벨 스코프

자바스크립트는 기본적으로 **함수 레벨 스코프**를 따릅니다.

- var로 선언된 변수는 함수의 코드 블록만을 지역 스코프로 인정
- 하지만 let과 const는 블록 레벨 스코프를 따름

```jsx
// var: 함수 레벨 스코프
function varTest() {
  var x = 1;
  if (true) {
    var x = 2;  // 같은 변수를 재할당
    console.log(x);  // 2
  }
  console.log(x);  // 2 - if 블록 내에서의 변경이 함수 전체에 영향
}

// let/const: 블록 레벨 스코프
function letTest() {
  let x = 1;
  if (true) {
    let x = 2;  // 다른 변수 (블록 스코프)
    console.log(x);  // 2
  }
  console.log(x);  // 1 - 원래 값 유지
}

varTest();
letTest();

```

### 함수 레벨 vs 블록 레벨 스코프:

```
함수 레벨 스코프 (var)           블록 레벨 스코프 (let/const)
+----------------------+        +----------------------+
|                      |        |                      |
| function varTest(){  |        | function letTest(){  |
|   var x = 1;         |        |   let x = 1;         |
|   +-------------+    |        |   +-------------+    |
|   | if(true){   |    |        |   | if(true){   |    |
|   |   var x = 2;| ---+---> 같은 x  |   let x = 2;| ---+---> 다른 x
|   |   ...       |    |        |   |   ...       |    |
|   +-------------+    |        |   +-------------+    |
|   console.log(x); // 2        |   console.log(x); // 1
| }                    |        | }                    |
|                      |        |                      |
+----------------------+        +----------------------+

```

---

## 📌 13.5 렉시컬 스코프

**렉시컬 스코프(Lexical Scope)**: 함수를 어디서 호출했는지가 아니라, **어디에 정의했는지**에 따라 스코프가 결정됩니다.

```jsx
const x = 1;

function foo() {
  const x = 10;
  bar();
}

function bar() {
  console.log(x); // 1
}

foo(); // 1 - bar 함수는 전역에서 정의되었으므로 전역 x를 참조

```

**렉시컬 환경**: 스코프를 구현하는 내부 메커니즘, 환경 레코드와 외부 렉시컬 환경에 대한 참조로 구성

### 렉시컬 스코프 시각화:

```
+------------------------------------------+
|                                          |
|  전역 스코프                                |
|  const x = 1;                            |
|                                          |
|  +----------------------------------+    |
|  |                                  |    |
|  |  foo 함수 스코프                    |    |
|  |  const x = 10;                   |    |
|  |                                  |    |
|  |  bar(); // 호출 위치가 아닌          |    |
|  |          // 정의 위치가 중요         |    |
|  |                                  |    |
|  +----------------------------------+    |
|                                          |
|  +----------------------------------+    |
|  |                                  |    |
|  |  bar 함수 스코프                    |    |
|  |  console.log(x); // 1            |    |
|  |  // 전역 x 참조 (정의된 위치)         |    |
|  |                                  |    |
|  +----------------------------------+    |
|                                          |
+------------------------------------------+
```

---

## 🔑 핵심 정리

1. **스코프는 변수의 유효 범위**를 결정
2. **스코프 체인**을 통해 변수를 검색
3. **렉시컬 스코프**는 함수 정의 위치에 따라 결정